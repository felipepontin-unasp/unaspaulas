---
title: "Cota√ß√£o do Dolar"
author: "Felipe Pontin"
date: "2025-11-22"
categories: [news, code, analysis]
jupyter: python3
---

Se voc√™ j√° se perguntou como os sites de not√≠cias e plataformas financeiras conseguem dados hist√≥ricos de moedas, a resposta muitas vezes est√° nas APIs (Interfaces de Programa√ß√£o de Aplicativos) de bancos centrais


![](Dolar.jpg)

Tutorial Completo: Como Obter a Cota√ß√£o Hist√≥rica do D√≥lar PTAX com Python e Plotly

Se voc√™ precisa acompanhar a varia√ß√£o do d√≥lar ao longo do tempo para an√°lises financeiras ou projetos de dados, este tutorial √© para voc√™. Vamos usar o Python para buscar dados oficiais no Banco Central do Brasil (BCB) e criar um gr√°fico interativo de forma simples e r√°pida.

O Resultado: Um gr√°fico de linhas bonito e interativo, como este:

```{python}
import requests
import calendar
from datetime import datetime, timedelta
import plotly.graph_objects as go


def f(periodo):
    """
    Busca cota√ß√£o do d√≥lar para um per√≠odo (MMYYYY) e gera gr√°fico.
    
    Args:
        periodo: String no formato "MMYYYY" (ex: "012022")
        
    Returns:
        Figura do Plotly com gr√°fico de linha da cota√ß√£o
    """
    first_date = datetime.strptime(periodo, "%m%Y")
    last_date = first_date.replace(
        day=calendar.monthrange(first_date.year, first_date.month)[1]
    )
    
    data_inicial = first_date.strftime("%m-%d-%Y")
    data_final = last_date.strftime("%m-%d-%Y")
    
    url = f"https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)?@dataInicial='{data_inicial}'&@dataFinalCotacao='{data_final}'&$format=json"
    
    print(f"Buscando cota√ß√µes de {first_date.strftime('%d/%m/%Y')} a {last_date.strftime('%d/%m/%Y')}...")
    
    try:
        response = requests.get(url)
        response.raise_for_status()
        data = response.json()
    except requests.exceptions.RequestException as e:
        print(f"Erro ao buscar dados: {e}")
        return None
    
    cotacoes = data.get('value', [])
    
    if not cotacoes:
        print("Nenhuma cota√ß√£o encontrada para este per√≠odo.")
        return None
    
    cotacoes_dict = {}
    for cotacao in cotacoes:
        data_cotacao = datetime.strptime(cotacao['dataHoraCotacao'], "%Y-%m-%d %H:%M:%S.%f")
        cotacoes_dict[data_cotacao.date()] = {
            'compra': cotacao['cotacaoCompra'],
            'venda': cotacao['cotacaoVenda']
        }
    
    datas = []
    valores_compra = []
    valores_venda = []
    
    current_date = first_date
    ultima_cotacao = None
    
    while current_date <= last_date:
        date_key = current_date.date()
        
        if date_key in cotacoes_dict:
            ultima_cotacao = cotacoes_dict[date_key]
        
        if ultima_cotacao:
            datas.append(current_date)
            valores_compra.append(ultima_cotacao['compra'])
            valores_venda.append(ultima_cotacao['venda'])
        
        current_date += timedelta(days=1)
    
    fig = go.Figure()
    
    fig.add_trace(go.Scatter(
        x=datas,
        y=valores_compra,
        mode='lines+markers',
        name='Cota√ß√£o Compra',
        line=dict(color='blue', width=2),
        marker=dict(size=4)
    ))
    
    fig.add_trace(go.Scatter(
        x=datas,
        y=valores_venda,
        mode='lines+markers',
        name='Cota√ß√£o Venda',
        line=dict(color='red', width=2),
        marker=dict(size=4)
    ))
    
    mes_nome = first_date.strftime("%B").capitalize()
    ano = first_date.year
    
    fig.update_layout(
        title=f'Cota√ß√£o do D√≥lar - {mes_nome} de {ano}',
        xaxis_title='Data',
        yaxis_title='Cota√ß√£o (R$)',
        hovermode='x unified',
        template='plotly_white',
        xaxis=dict(tickformat='%d/%m'),
        height=600
    )
    
    print(f"Gr√°fico gerado com sucesso! Total de dias: {len(datas)}")
    
    return fig


periodo = "012022"
fig = f(periodo)
fig.show()
```


üõ†Ô∏è Passo 1: Preparando o Ambiente

Nosso c√≥digo depende de algumas bibliotecas. Abra o terminal (ou o terminal integrado do VS Code) e instale o que √© necess√°rio:

pip install requests plotly kaleido


requests: Essencial para fazer a conex√£o e buscar os dados da API do BCB.

plotly: Cria os gr√°ficos interativos e profissionais.

kaleido: Um requisito do Plotly para exportar ou exibir os gr√°ficos corretamente em alguns ambientes.

üêç Passo 2: O C√≥digo Python

Crie um novo arquivo chamado dolar_cotacao.py e insira o c√≥digo abaixo. Ele est√° configurado para buscar a cota√ß√£o do m√™s de Janeiro de 2022 ("012022"), mas voc√™ pode mudar o per√≠odo facilmente no final do script.

import requests
import calendar
from datetime import datetime, timedelta
import plotly.graph_objects as go
import locale
import sys

# --- Configura√ß√µes de Locale para Portugu√™s ---
# Isso garante que o nome do m√™s e a formata√ß√£o sejam em portugu√™s.
try:
    locale.setlocale(locale.LC_ALL, 'pt_BR.UTF-8')
except locale.Error:
    try:
        locale.setlocale(locale.LC_ALL, 'pt_PT.UTF-8')
    except locale.Error:
        try:
            locale.setlocale(locale.LC_ALL, '')
        except locale.Error:
             print("Aviso: N√£o foi poss√≠vel configurar o locale para portugu√™s.")

def buscar_cotacao_e_gerar_grafico(periodo):
    """
    Busca cota√ß√£o do d√≥lar (PTAX) para um per√≠odo (MMYYYY) e gera gr√°fico.
    
    A cota√ß√£o segue a regra: se n√£o houver cota√ß√£o em um dia, a √∫ltima 
    cota√ß√£o dispon√≠vel √© utilizada (comum em fins de semana/feriados).
    
    Args:
        periodo: String no formato "MMYYYY" (ex: "082021")
        
    Returns:
        Figura do Plotly (go.Figure) com gr√°fico de linha da cota√ß√£o
    """
    try:
        # 1. Determina as datas de in√≠cio e fim do m√™s
        first_date = datetime.strptime(periodo, "%m%Y")
        last_day = calendar.monthrange(first_date.year, first_date.month)[1]
        last_date = first_date.replace(day=last_day)
    except ValueError:
        print(f"Erro: O per√≠odo '{periodo}' est√° no formato incorreto. Use MMYYYY (ex: 082021).")
        return None
    
    # Formata datas para o endpoint da API do BCB (ex: 01-01-2022)
    data_inicial_api = first_date.strftime("%m-%d-%Y")
    data_final_api = last_date.strftime("%m-%d-%Y")
    
    # Monta a URL da API do Banco Central
    url = (
        f"[https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo](https://olinda.bcb.gov.br/olinda/servico/PTAX/versao/v1/odata/CotacaoDolarPeriodo)"
        f"(dataInicial=@dataInicial,dataFinalCotacao=@dataFinalCotacao)?"
        f"@dataInicial='{data_inicial_api}'&@dataFinalCotacao='{data_final_api}'&$format=json"
    )
    
    print(f"Buscando cota√ß√µes de {first_date.strftime('%d/%m/%Y')} a {last_date.strftime('%d/%m/%Y')}...")
    
    # 2. Faz a requisi√ß√£o √† API
    try:
        response = requests.get(url, timeout=10)
        response.raise_for_status() # Lan√ßa exce√ß√£o se houver erro HTTP
        data = response.json()
    except requests.exceptions.Timeout:
        print("Erro: Tempo limite da requisi√ß√£o excedido.")
        return None
    except requests.exceptions.RequestException as e:
        print(f"Erro ao buscar dados da API do BCB: {e}")
        return None
    
    cotacoes = data.get('value', [])
    
    if not cotacoes:
        print("Nenhuma cota√ß√£o encontrada para este per√≠odo.")
        return None
    
    # 3. Processa e preenche os dados (mantendo a √∫ltima cota√ß√£o para fins de semana)
    cotacoes_por_data = {}
    for cotacao in cotacoes:
        # Extrai apenas a data da string (YYYY-MM-DD)
        data_cotacao = datetime.strptime(cotacao['dataHoraCotacao'][:10], "%Y-%m-%d")
        cotacoes_por_data[data_cotacao.date()] = {
            'compra': cotacao['cotacaoCompra'],
            'venda': cotacao['cotacaoVenda']
        }
    
    datas = []
    valores_compra = []
    valores_venda = []
    
    current_date = first_date
    ultima_cotacao = None
    
    # Itera dia a dia para preencher fins de semana com a √∫ltima cota√ß√£o
    while current_date <= last_date:
        date_key = current_date.date()
        
        if date_key in cotacoes_por_data:
            ultima_cotacao = cotacoes_por_data[date_key]
        
        if ultima_cotacao:
            datas.append(current_date)
            valores_compra.append(ultima_cotacao['compra'])
            valores_venda.append(ultima_cotacao['venda'])
        
        current_date += timedelta(days=1)
    
    # 4. Gera a figura do Plotly
    fig = go.Figure()
    
    # Tra√ßado da Cota√ß√£o Compra
    fig.add_trace(go.Scatter(
        x=datas,
        y=valores_compra,
        mode='lines+markers',
        name='Cota√ß√£o Compra (PTAX)',
        line=dict(color='#1f77b4', width=3), # Azul moderno
        marker=dict(size=6, symbol='circle')
    ))
    
    # Tra√ßado da Cota√ß√£o Venda
    fig.add_trace(go.Scatter(
        x=datas,
        y=valores_venda,
        mode='lines+markers',
        name='Cota√ß√£o Venda (PTAX)',
        line=dict(color='#d62728', width=3), # Vermelho moderno
        marker=dict(size=6, symbol='diamond')
    ))
    
    # Formata√ß√£o do layout
    mes_nome = first_date.strftime("%B").capitalize()
    ano = first_date.year
    
    fig.update_layout(
        title={
            'text': f'Cota√ß√£o do D√≥lar PTAX - {mes_nome} de {ano}',
            'y':0.95,
            'x':0.5,
            'xanchor': 'center',
            'yanchor': 'top',
            'font': dict(size=20, color='#333')
        },
        xaxis_title='Dia do M√™s',
        yaxis_title='Cota√ß√£o (R$)',
        hovermode='x unified', # Mostra info dos dois tra√ßados no mesmo ponto
        template='plotly_white', # Tema limpo
        xaxis=dict(tickformat='%d/%m', showgrid=True, gridcolor='#e0e0e0'),
        yaxis=dict(tickprefix='R$ ', showgrid=True, gridcolor='#e0e0e0'),
        legend=dict(orientation="h", yanchor="bottom", y=1.02, xanchor="right", x=1),
        height=650,
        margin=dict(t=80, b=50, l=50, r=50)
    )
    
    print(f"Gr√°fico gerado com sucesso! Total de dias plotados: {len(datas)}")
    
    return fig

# --- Bloco Principal de Execu√ß√£o ---

# MUDE ESTA VARI√ÅVEL para o per√≠odo que voc√™ deseja (MMYYYY)
periodo_exemplo = "012022" 

print(f"Iniciando a busca para o per√≠odo: {periodo_exemplo}")
fig = buscar_cotacao_e_gerar_grafico(periodo_exemplo)

if fig:
    # A fun√ß√£o show() do Plotly abre o gr√°fico interativo no seu navegador.
    fig.show()
else:
    print("A execu√ß√£o foi conclu√≠da sem a gera√ß√£o do gr√°fico devido a erros ou falta de dados.")
